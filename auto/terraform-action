#!/bin/bash -eu

cd $(dirname $0)/..
source ./auto/set-env-var

ACTION=$1
ENV=${2-'test'}

display_status "Initialize terraform..."
auto/terraform init

if auto/terraform workspace new ${ENV}; then
    display_status "Workspace '${ENV}' created!"
fi

display_status "Start to ${ACTION} ${APP_NAME} in ${ENV} via terraform..."

auto/terraform workspace select ${ENV}
auto/terraform ${ACTION} -var-file env/${ENV}.tfvars

display_status "Done"
